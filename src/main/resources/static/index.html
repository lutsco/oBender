<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bender LLM</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<h1>Ask Bender</h1>
<form id="benderForm">
    <input type="text" id="prompt" placeholder="Ask Bender" />
    <button type="submit">Ask</button>
</form>
<div id="response"></div>

<script>
    document.getElementById("benderForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const prompt = document.getElementById("prompt").value.trim();
        if (!prompt) {
            document.getElementById("response").innerText = "Please enter a valid prompt.";
            return;
        }

        console.log("Prompt submitted:", prompt); // Debug log

        try {
            document.getElementById("response").innerText = "Loading...";
            const response = await fetch("http://localhost:8081/api/bender/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(prompt),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const text = await response.text();
            console.log("Response from server:", text); // Debug log
            document.getElementById("response").innerText = formatResponse(text);
        } catch (error) {
            console.error("Error in fetch:", error); // Log errors
            document.getElementById("response").innerText = "Error communicating with the server. Please try again.";
        }
    });

    function formatResponse(text) {
        const maxLength = 80; // Max characters per line
        const words = text.split(" ");
        let formattedText = "";
        let currentLength = 0;

        for (const word of words) {
            if (currentLength + word.length + 1 > maxLength) {
                formattedText += "\n";
                currentLength = 0;
            }
            formattedText += word + " ";
            currentLength += word.length + 1;
        }
        return formattedText.trim();
    }
</script>
</body>
</html>
